{"name":"Webcam-pulse-detector","tagline":"A python application that detects and highlights the heart-rate of an individual (using only their own webcam) in real-time.","body":"![Alt text](http://i.imgur.com/2ngZopS.jpg \"Screenshot\")\r\n\r\nwebcam-pulse-detector\r\n-----------------------\r\n\r\n-------------------\r\n\r\nUPDATE: Stand-alone (no dependancy) precompiled application now available!\r\n - Download for Windows 7 and 8: [webcam-pulse-detector_win.zip](http://sourceforge.net/projects/webcampulsedetector/files/webcam-pulse-detector_win.zip/download) (42 Mb) \r\n - Download for Mac OSX 10.6 (and later): [webcam-pulse-detector_mac.zip](http://sourceforge.net/projects/webcampulsedetector/files/webcam-pulse-detector_mac.zip/download) (21 Mb)\r\n - Debian/Ubuntu/Mint Linux: Coming very soon. For now, it is recommended that you run from source on the `no_openmdao` branch if you just want to test things out.\r\n\r\nThe application can be run by simply executing the binary contained in the zip file for your platform.\r\nThis code can also be run from source by [following the instructions below](#running-from-source).\r\n \r\n-------------------\r\n\r\nA python code that detects the heart-rate of an individual using a common webcam or network IP camera. \r\nTested on OSX 10.8 (Mountain Lion), Ubuntu 13.04 (Ringtail), and Windows 7 & 8.\r\n\r\nInspired by reviewing recent work on [Eulerian Video Magnification](http://people.csail.mit.edu/mrub/vidmag/), \r\nwith motivation to implement something visually comparable (though not necessarily identical in formulation) to their\r\npulse detection examples using [Python](http://python.org/) and [OpenCV](http://opencv.org/) (see https://github.com/brycedrennan/eulerian-magnification for a \r\nmore general take on the offline post-processing methodology). \r\nThis goal is comparable to those of a few previous efforts in this area \r\n(such as https://github.com/mossblaser/HeartMonitor).\r\n\r\nThis code was developed at [NASA Glenn Research Center](http://www.nasa.gov/centers/glenn) in \r\nsupport of [OpenMDAO](http://openmdao.org/), under the Aeronautical Sciences Project in NASA's \r\n[Fundamental Aeronautics Program](http://www.aeronautics.nasa.gov/fap/), as well as the Crew State Monitoring Element \r\nof the Vehicle Systems Safety Technologies Project, in NASAâ€™s \r\n[Aviation Safety Program](http://www.aeronautics.nasa.gov/programs_avsafe.htm).\r\n\r\nHow it works:\r\n-----------------\r\nThis application uses [OpenCV](http://opencv.org/) to find the location of the user's face, then isolate the forehead region. Data is collected\r\nfrom this location over time to estimate the user's heart rate. This is done by measuring average optical\r\nintensity in the forehead location, in the subimage's green channel alone (a better color mixing ratio may exist, but the \r\nblue channel tends to be very noisy). Physiological data can be estimated this way via a combination of \r\n[photoplethysmology](http://en.wikipedia.org/wiki/Photoplethysmogram) and the optical absorption \r\ncharacteristics of (oxy-) haemoglobin (see http://www.opticsinfobase.org/oe/abstract.cfm?uri=oe-16-26-21434). \r\n\r\nWith good lighting and minimal noise due to motion, a stable heartbeat should be \r\nisolated in about 15 seconds. Other physiological waveforms (such as \r\n[Mayer waves](http://en.wikipedia.org/wiki/Mayer_waves)) should also be visible in the raw data stream.\r\n\r\nOnce the user's heart rate has been estimated, real-time phase variation associated with this \r\nfrequency is also computed. This allows for the heartbeat to be exaggerated in the post-process frame rendering, \r\ncausing the highlighted forehead location to pulse in sync with the user's own heartbeat.\r\n\r\nSupport for detection on multiple simultaneous individuals in a single camera's \r\nimage stream is definitely possible, but at the moment only the information from one face \r\nis extracted for analysis.\r\n\r\nThe overall dataflow/execution order for the real-time signal processing looks like:\r\n\r\n![Alt text](http://i.imgur.com/xS7O8U3.png \"Signal processing\")\r\n\r\nThis signal processing design is implemented in the OpenMDAO assembly object defined in\r\n[lib/processors.py](lib/processors.py).\r\n\r\nThe definition of each component block used can be found in the source \r\nfiles [lib/imageProcess.py](lib/imageProcess.py), [lib/signalProcess.py](lib/signalProcess.py), and \r\n[lib/sliceops.py](lib/sliceops.py). The `@bin` and `@bout` blocks in the above graph denote assembly-level input and \r\noutput.\r\n\r\n\r\nRunning from source:\r\n---------------\r\n\r\n### Basic requirements: \r\n\r\n- [Python v2.7+](http://python.org/)\r\n- Numpy and Scipy \r\n- Pyserial (for serial port output support)\r\n- [OpenCV v2.4+](http://opencv.org/), with the cv2 python bindings\r\n \r\nOpenCV is a powerful open-source computer vision library, with a convenient \r\nnumpy-compatible interface in the cv2 bindings.\r\n\r\n**If you want to run from source and modify UI or data output behavior, and make only minor changes \r\nto the signal processing, you can checkout and run the `no_openmdao` branch with no further dependancies.**\r\nThis branch implements a 'flattened' version of the master branch's OpenMDAO assembly, but as a plain python object.\r\n\r\nBoth the `no_openmdao` branch and the precompiled binary applications contain support for real time serial port and UDP output of the estimated heart rate.\r\n\r\nHowever, if you would like to make significant or exploratory changes to the signal processing code (eg. multichannel support, PCA/ICA data factorizations, better filters, etc.), you should run the master\r\nbranch with OpenMDAO support and build on what is already there (see instructions below).\r\n\r\n### Requirements for master branch (OpenMDAO support):\r\n\r\n- [OpenMDAO v0.9+](http://openmdao.org/)\r\n\r\nOpenMDAO is an open-source engineering framework that serves as a convenient \r\nenvironment to containerize the required real-time analysis, and \r\nallow for that analysis to be easily tweaked to specification and compared with alternative designs. \r\nUpon installation, OpenMDAO is bootstrapped into its own Python \r\nvirtualenv, which must be activated before use (see the Quickstart section below). OpenMDAO requires python 2.6+, numpy, scipy, and matplotlib \r\n(see http://openmdao.org/docs/getting-started/requirements.html)\r\n\r\n**Running Windows, completely new to Python, but still would like to hack on the `master` branch source code? Full instructions for getting started with all requirements needed to\r\nrun this code are available [here](win_pythonxy.md)**\r\n\r\nQuickstart:\r\n------------\r\n\r\n### On branch `no_openmdao`:\r\n\r\n- Simply run `get_pulse.py` in the top level directory.\r\n\r\n### On branch `master`:\r\n\r\n- Activate the openMDAO virtual python environment in a command or terminal window. On Linux and OSX, this is done by\r\nrunning (note the period):\r\n\r\n```\r\n. OpenMDAO/bin/activate\r\n```\r\nOr on Windows:\r\n\r\n```\r\nOpenMDAO\\Scripts\\activate\r\n```\r\n\r\n- In the activated environment, navigate to the downloaded source directory, and run get_pulse.py to start the application\r\n\r\n```\r\npython get_pulse.py\r\n```\r\n\r\n- If there is an error, try running `test_webcam.py` in the same directory to check if your openCV installation and webcam can be made to work\r\nwith this application.\r\n\r\nUsage notes:\r\n----------\r\n- When run, a window will open showing a stream from your computer's webcam\r\n- When a forehead location has been correctly detected and isolated, the user should press \"S\" on their \r\nkeyboard to lock this location, and remain as still as possible (the camera \r\nstream window must have focus for the click to register). This freezes the acquisition location in place. This lock can\r\nbe released by pressing \"S\" again.\r\n- To view a stream of the measured data as it is gathered, press \"D\". To hide this display, press \"D\" again.\r\n- The data display shows three data traces, from top to bottom: \r\n   1. (top) raw optical intensity\r\n   2. (bottom) Power spectral density, with local maxima indicating the heartrate (in beats per minute). \r\n- With consistent lighting and minimal head motion, a stable heartbeat should be \r\nisolated in about 15 seconds. A count-down is shown in the image frame.\r\n\r\nTODO:\r\n------\r\n- There have been some requests for a video demo\r\n- Instead of processing using the green channel alone, it is likely that some fixed combination of the statistics of the\r\nR,G,B channels could instead be optimal (though I was unable to find a simple combination that was better than green\r\nalone). If so, the mixing ratios might be determinable from the forward projection matrices of PCA or ICA operators \r\ncomputed on a set of mean value R,G, and B data gathered over a trial data set (and verified with different individuals \r\nunder different lighting conditions).\r\n- Support for multiple individuals\r\n- Smoother tracking of data from foreheads, perhaps by buffering and registering or inverse-transforming image subframes\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}